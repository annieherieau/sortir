{% extends 'base.html.twig' %}

{% block title %}Hello SortieController!{% endblock %}

{% block main %}
    {#        TODO: block filtre #}
    <div>
        <label>
            <select>
                {% for c in campusList %}
                    {% set selected = c.sorties.count() > 0 ? 'selected' : '' %}
                    <option value="{{ c.id }}" {{ selected }}>{{ c.name }}</option>
                {% endfor %}
            </select>
        </label>
    </div>

    <table>
        <thead>
        <tr>
            <th>Nom de la sortie</th>
            <th>Date de la sortie</th>
            <th>Clôture</th>
            <th>Inscrits / Places</th>
            <th>Etat</th>
            <th>Inscrit(e)</th>
            <th>Organisateur</th>
            <th>Actions</th>
        </tr>
        </thead>
        <tbody>
        {% for s in sorties %}
            <tr>
            {#            TODO : vérifier isRegistred lorsque dev login ok #}
            {% set isRegistred = s.registred(app.user) %}
            {% set isTheOwner = s.theOwner(app.user) %}
            <td>{{ s.name }}</td>
            <td>{{ s.startingDate | date ('d/m/Y h:i') }}
            </td>
            <td>{{ s.registerLimitDate | date ('d/m/Y') }}</td>
            <td>{{ s.participants.count }}/{{ s.maxRegistrationNumber }}</td>
            <td>{{ s.state.libelle }}</td>
            <td>{{  isRegistred ? 'X' : '' }}</td>
            <td>
                {% if not isTheOwner %}
                    {{ s.owner.pseudo }}
                {% else %}
                    {#                    TODO ajouter le lien vers la consultation du profil #}
                    <a href="/" title="Afficher le profil">{{ s.owner.pseudo }} </a>
                {% endif %}
            </td>
            {#        ******* ACTIONS  ******* #}
            {#               TODO ajouter le liens #}
            <td>
                {#                SE DESISTER #}
                {% if isRegistred  and s.state.nb < 3 %}
                    <a href="/" title="Se désister">Se désister</a>
                {% endif %}
                {#                S'INSCRIRE' #}
                {% if not isRegistred  and s.state.nb == 1 %}
                    <a href="/" title="S'inscrire">S'inscrire</a>
                {% endif %}

                {#                ANNULER #}
                {% if (s.state.nb > 0 and s.state.nb < 3) and ( is_granted('ROLE_ADMIN') or isTheOwner ) %}
                    <a href="/" title="Annuler la sortie">Annuler</a>
                {% endif %}

                <a href="/" title="Afficher les détails de la sortie">Afficher</a>

                {% if isTheOwner %}
                    {#                TODO ajouter le lien Annuler la sortie #}
                    <a href="/" title="Annuler la sortie">Annuler</a>
                {% else %}
                {% endif %}

            </td>
            </tr>
        {% endfor %}
        </tbody>
    </table>

    {#        TODO: Bouton Créer une sortie #}

{% endblock %}
